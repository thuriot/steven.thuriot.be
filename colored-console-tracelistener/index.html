<!DOCTYPE html> <html> <head> <meta charset="utf-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <title>Colored Console TraceListener &mdash; Steven Thuriot.be</title> <meta name="description" content="Blogging about things on your new Jekyll site"/> <link rel="canonical" href="//steven.thuriot.be/colored-console-tracelistener"> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="theme-color" content="#434a4d"> <link rel="icon" sizes="192x192" href="//cdn.thuriot.be/images/Avatars/Raven.jpg"> <link rel="stylesheet" type="text/css" href="//steven.thuriot.be/assets/css/screen.css"/> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"> <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic%7CMontserrat:400,700"> </head> <body class="post-template"> <header id="orbs-bar" class="sidebar no-cover"> <nav id="site-head"> <div id="site-head-logo"> <a id="blog-logo" href="//steven.thuriot.be/"><img src="//cdn.thuriot.be/images/Avatars/Raven.jpg" alt="Steven Thuriot.be" title="Home"></a> </div> <div class="blog-links"> <a class="fa fa-terminal" role="presentation" href="//steven.thuriot.be/projects" title="Projects"></a> <a class="fa fa-github-alt" role="presentation" href="//steven.thuriot.be/GitHub" title="GitHub"></a> <a class="fa fa-street-view" role="presentation" href="//steven.thuriot.be/cv" title="Curriculum Vitae"></a> <a class="fa fa-rss" role="presentation" href="//steven.thuriot.be/rss" target="_blank" title="Subscribe"></a> </div> </nav> </header> <div class="main-header post-head" style="background-image: url(//cdn.thuriot.be/images/Covers/ascii.png)"></div> <main class="content" role="main"> <article class="post"> <header class="post-header"> <h1 class="post-title">Colored Console TraceListener</h1> <section class="post-meta"> <time class="post-date" datetime="2015-08-31">31 August 2015</time> on <a href="//steven.thuriot.be/tag/c/">C#</a>, <a href="//steven.thuriot.be/tag/console/">Console</a>, <a href="//steven.thuriot.be/tag/trace/">Trace</a>, <a href="//steven.thuriot.be/tag/tracelistener/">Tracelistener</a> </section> </header> <section class="post-content"> <p>Writing to the <code>Console</code> can provide a lot of useful information while developing. While this can easily be done by using the static <code>Console</code> class, I prefer using the <code>Trace</code> class instead.</p> <p>Doing it this way, our code is easily reusable for other kinds of logging and provides the ability to add additional metadata, which can also be used to filter the messages (e.g. the type).</p> <p><code>System.Diagnostics</code> provides the <code>ConsoleTraceListener</code> class to combine these two. But I like to spice it up a bit and color-code the different types of events.</p> <p>This can easily be done by inheriting the provided TraceListener and overriding the <code>ConsoleColor</code> before writing our events.</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">ColorConsoleTraceListener</span> <span class="p">:</span> <span class="n">ConsoleTraceListener</span>
<span class="p">{</span>
  <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">IReadOnlyDictionary</span><span class="p">&lt;</span><span class="n">TraceEventType</span><span class="p">,</span> <span class="n">ConsoleColor</span><span class="p">&gt;</span> <span class="n">_colors</span><span class="p">;</span>
  <span class="k">static</span> <span class="nf">ColorConsoleTraceListener</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">_colors</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">TraceEventType</span><span class="p">,</span> <span class="n">ConsoleColor</span><span class="p">&gt;</span>
                    <span class="p">{</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Verbose</span><span class="p">,</span>      <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">DarkGray</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Information</span><span class="p">,</span>  <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">Gray</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Warning</span><span class="p">,</span>      <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">Yellow</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Error</span><span class="p">,</span>        <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">DarkRed</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Critical</span><span class="p">,</span>     <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">Red</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Start</span><span class="p">,</span>        <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">DarkCyan</span><span class="p">},</span>
                        <span class="p">{</span><span class="n">TraceEventType</span><span class="p">.</span><span class="n">Stop</span><span class="p">,</span>         <span class="n">ConsoleColor</span><span class="p">.</span><span class="n">DarkGreen</span><span class="p">}</span>
                    <span class="p">};</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">bool</span> <span class="n">_prependEventType</span><span class="p">;</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">bool</span> <span class="n">_prependSource</span><span class="p">;</span>
  <span class="k">public</span> <span class="nf">ColorConsoleTraceListener</span><span class="p">(</span><span class="kt">bool</span> <span class="n">prependEventType</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">prependSource</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">_prependEventType</span> <span class="p">=</span> <span class="n">prependEventType</span><span class="p">;</span>
      <span class="n">_prependSource</span> <span class="p">=</span> <span class="n">prependSource</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">TraceEvent</span><span class="p">(</span><span class="n">TraceEventCache</span> <span class="n">eventCache</span><span class="p">,</span> <span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="n">TraceEventType</span> <span class="n">eventType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Trace</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">eventType</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">TraceEvent</span><span class="p">(</span><span class="n">TraceEventCache</span> <span class="n">eventCache</span><span class="p">,</span> <span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="n">TraceEventType</span> <span class="n">eventType</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">format</span><span class="p">,</span> <span class="k">params</span> <span class="kt">object</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">Trace</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">eventType</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="n">args</span><span class="p">));</span>
  <span class="p">}</span>

  <span class="k">private</span> <span class="k">void</span> <span class="nf">Trace</span><span class="p">(</span><span class="kt">string</span> <span class="n">source</span><span class="p">,</span> <span class="n">TraceEventType</span> <span class="n">eventType</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="n">ConsoleColor</span><span class="p">?</span> <span class="n">previousColor</span><span class="p">;</span>
      <span class="n">ConsoleColor</span> <span class="n">color</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">_colors</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">eventType</span><span class="p">,</span> <span class="k">out</span> <span class="n">color</span><span class="p">))</span>
      <span class="p">{</span>
          <span class="n">previousColor</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="n">ForegroundColor</span><span class="p">;</span>
          <span class="n">Console</span><span class="p">.</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="n">color</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="p">{</span>
          <span class="n">previousColor</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">_prependSource</span><span class="p">)</span> <span class="n">Write</span><span class="p">(</span><span class="n">source</span> <span class="p">+</span> <span class="s">&quot; — &quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">_prependEventType</span><span class="p">)</span> <span class="n">Write</span><span class="p">(</span><span class="n">eventType</span> <span class="p">+</span> <span class="s">&quot; — &quot;</span><span class="p">);</span>
      <span class="n">WriteLine</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">previousColor</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">Console</span><span class="p">.</span><span class="n">ForegroundColor</span> <span class="p">=</span> <span class="n">previousColor</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </section> <footer class="post-footer with-cover" style="background-image: url(//cdn.thuriot.be/images/Covers/db0b47_5415753.jpg)"> <figure class="author-image"> <a class="img" href="//steven.thuriot.be/author/steven" style="background-image: url(//cdn.thuriot.be/images/Avatars/2014-07-06.jpg)"> <span class="hidden">Steven Thuriot's Picture</span></a> </figure> <section class="author"> <h4><a href="//steven.thuriot.be/author/steven">Steven Thuriot</a></h4> <p>Developer, tinkerer, lifetime student, full time nerd and somewhat of an otaku. Graduated applied computer science followed by a career as a consultant. Likes to complain about traffic.</p> <div class="author-meta"> <span class="author-location fa fa-map-marker">Belgium</span> </div> </section> </footer> </article> <section class="disqus"> <div id="disqus_thread"></div> <script type="text/javascript">(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//thuriot.disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a);})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript> </section> </main> <footer class="site-footer clearfix wide"> <section class="copyright"><a href="//steven.thuriot.be/">Steven Thuriot.be</a> &copy; 2015</section> <p class="clearfix"/> <section class="poweredby"><a href="https://github.com/StevenThuriot/Marbles" target="_blank">Marbles</a> &mdash; Designed with <i class="fa fa-heart"></i> by <a href="https://github.com/StevenThuriot" target="_blank">Steven Thuriot</a></section> </footer> <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script> <script type="text/javascript" src="//steven.thuriot.be/assets/js/jquery.fitvids.js"></script> </body> </html>
<!DOCTYPE html> <html> <head> <meta charset="utf-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <title>Steven Thuriot.be &mdash; Thoughts, stories and ideas.</title> <meta name="description" content="Blogging about things on your new Jekyll site"/> <link rel="canonical" href="https://steven.thuriot.be/testing-for-exceptions"> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="theme-color" content="#434a4d"> <link rel="icon" sizes="192x192" href="//cdn.thuriot.be/images/Avatars/Raven.jpg"> <link rel="stylesheet" type="text/css" href="//steven.thuriot.be/assets/css/main.css"/> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic%7CMontserrat:400,700"> </head> <body class="post-template"> <header id="orbs-bar" class="sidebar no-cover"> <nav id="site-head"> <div id="site-head-logo"> <a id="blog-logo" href="//steven.thuriot.be"><img src="//cdn.thuriot.be/images/Avatars/Raven.jpg" alt="Steven Thuriot.be" title="Home"></a> </div> <div class="blog-links"> <a class="fa fa-terminal" role="presentation" href="//steven.thuriot.be/projects" title="Projects"></a> <a class="fa fa-github-alt" role="presentation" href="//steven.thuriot.be/GitHub" title="GitHub"></a> <a class="fa fa-street-view" role="presentation" href="//steven.thuriot.be/cv" title="Curriculum Vitae"></a> <a class="fa fa-rss" role="presentation" href="//steven.thuriot.be/rss" target="_blank" title="Subscribe"></a> </div> </nav> </header> <main class="content" role="main"> <article class="post"> <header class="post-header"> <h1 class="post-title">Testing for exceptions</h1> <section class="post-meta"> <time class="post-date" datetime="2010-12-30">30 December 2010</time> on <a href="//steven.thuriot.be/tag/c/">C#</a>, <a href="//steven.thuriot.be/tag/exceptions/">Exceptions</a>, <a href="//steven.thuriot.be/tag/helper/">Helper</a> </section> </header> <section class="post-content"> <p>Every piece of software should at least have unit tests. Quite a few of these tests will probably be used to see if the method is correctly throwing an exception when needed.</p> <p>However, often the unit test&#39;s <em>ExpectedException</em> attribute just doesn&#39;t cut it. Imagine having two possible exceptions thrown from a certain method, both having the same exception type but different messages. To make testing for this easier, I wrote a little helper class!</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Microsoft.VisualStudio.TestTools.UnitTesting</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">Assertion.Test</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">AssertHelper</span>
    <span class="p">{</span>
        <span class="c1">///&lt;summary&gt;</span>
        <span class="c1">/// Checks of the action throws the specified Exception.</span>
        <span class="c1">/// It also checks if the messages are the same.</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;typeparam name=&quot;T&quot;&gt;The type of exception to be thrown.&lt;/typeparam&gt;</span>
        <span class="c1">/// &lt;param name=&quot;action&quot;&gt;The action to be performed.&lt;/param&gt;</span>
        <span class="c1">/// &lt;param name=&quot;expectedMessage&quot;&gt;The expected message.&lt;/param&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">Throws</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Action</span> <span class="n">action</span><span class="p">,</span> <span class="n">String</span> <span class="n">expectedMessage</span><span class="p">)</span>
             <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">Exception</span>
        <span class="p">{</span>
            <span class="n">Boolean</span> <span class="n">fail</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

            <span class="k">try</span>
            <span class="p">{</span>
                <span class="n">action</span><span class="p">.</span><span class="n">Invoke</span><span class="p">();</span>
                <span class="n">fail</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">exc</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">&lt;</span><span class="n">Type</span><span class="p">&gt;(</span><span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">exc</span><span class="p">.</span><span class="n">GetType</span><span class="p">(),</span>
                         <span class="s">&quot;An exception of the wrong type was thrown ({0} instead of {1}).&quot;</span><span class="p">,</span>
                         <span class="n">exc</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">);</span>
                <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;(</span><span class="n">expectedMessage</span><span class="p">,</span> <span class="n">exc</span><span class="p">.</span><span class="n">Message</span><span class="p">,</span> <span class="s">&quot;The messages are not equal.&quot;</span><span class="p">);</span>
            <span class="p">}</span>

        Â    <span class="k">if</span> <span class="p">(</span><span class="n">fail</span><span class="p">)</span>
                <span class="n">Assert</span><span class="p">.</span><span class="n">Fail</span><span class="p">(</span><span class="s">&quot;Exception of type {0} should have been thrown.&quot;</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">T</span><span class="p">).</span><span class="n">Name</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>This method will check if the exception gets thrown, if it throws the correct type of exception and if the message is correct!</p> <p>Using it goes as follows:</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">AssertHelper</span><span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">RepositoryException</span><span class="p">&gt;</span>
<span class="p">(</span>
    <span class="p">()</span> <span class="p">=&gt;</span> <span class="kt">object</span><span class="p">.</span><span class="n">Method</span><span class="p">(),</span>
    <span class="s">&quot;This is the exception&#39;s message!&quot;</span>
<span class="p">);</span>
</code></pre></div> <p>The generic refers to the exception that you are expecting. The first parameter is the method that will be called, the second is the message that the thrown exception will show.</p> </section> <footer class="post-footer with-cover" style="background-image: url(//cdn.thuriot.be/images/Covers/db0b47_5415753.jpg)"> <figure class="author-image"> <a class="img" href="//steven.thuriot.be/author/steven" style="background-image: url(//cdn.thuriot.be/images/Avatars/2014-07-06.jpg)"> <span class="hidden">Steven Thuriot's Picture</span></a> </figure> <section class="author"> <h4><a href="//steven.thuriot.be/author/steven">Steven Thuriot</a></h4> <p>Developer, tinkerer, lifetime student, full time nerd and somewhat of an otaku. Graduated applied computer science followed by a career as a consultant. Likes to complain about traffic.</p> <div class="author-meta"> <span class="author-location fa fa-map-marker">Belgium</span> </div> </section> </footer> </article> <section class="disqus"> <div id="disqus_thread"></div> <script type="text/javascript">(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//thuriot.disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a);})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript> </section> </main> <footer class="site-footer clearfix wide"> <section class="copyright"><a href="//steven.thuriot.be">Steven Thuriot.be</a> &copy; 2015</section> </footer> <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script> <script type="text/javascript" src="//steven.thuriot.be/assets/js/jquery.fitvids.js"></script> </body> </html>
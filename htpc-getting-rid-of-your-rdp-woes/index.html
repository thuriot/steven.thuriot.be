<!DOCTYPE html> <html> <head> <meta charset="utf-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <title>Steven Thuriot.be &mdash; Thoughts, stories and ideas.</title> <meta name="description" content="Blogging about things on your new Jekyll site"/> <link rel="canonical" href="http://steven.thuriot.be/htpc-getting-rid-of-your-rdp-woes"> <meta name="HandheldFriendly" content="True"/> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <meta name="theme-color" content="#434a4d"> <link rel="icon" sizes="192x192" href="//cdn.thuriot.be/Avatars/Raven.jpg"> <link rel="stylesheet" type="text/css" href="//steven.thuriot.be/assets/css/main.css"/> <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"> <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic%7CMontserrat:400,700"> </head> <body class="post-template"> <header id="orbs-bar" class="sidebar no-cover"> <nav id="site-head"> <div id="site-head-logo"> <a id="blog-logo" href="//steven.thuriot.be"><img src="//cdn.thuriot.be/Avatars/Raven.jpg" alt="Steven Thuriot.be" title="Home"></a> </div> <div class="blog-links"> <a class="fa fa-terminal" role="presentation" href="//projects" title="Projects"></a> <a class="fa fa-github-alt" role="presentation" href="//github" title="GitHub"></a> <a class="fa fa-street-view" role="presentation" href="//cv" title="Curriculum Vitae"></a> <a class="fa fa-rss" role="presentation" href="//steven.thuriot.be/rss" target="_blank" title="Subscribe"></a> </div> </nav> </header> <div class="main-header post-head" style="background-image: url(http://cdn.thuriot.be/Covers/NESRemote.png)"></div> <main class="content" role="main"> <article class="post"> <header class="post-header"> <h1 class="post-title">HTPC: Getting rid of your RDP Woes</h1> <section class="post-meta"> <time class="post-date" datetime="2014-12-30">30 December 2014</time> on <a href="//steven.thuriot.be/tag/disconnect/">Disconnect</a>, <a href="//steven.thuriot.be/tag/htpc/">Htpc</a>, <a href="//steven.thuriot.be/tag/rdp/">Rdp</a>, <a href="//steven.thuriot.be/tag/windows/">Windows</a>, <a href="//steven.thuriot.be/tag/without-lock/">Without Lock</a> </section> </header> <section class="post-content"> <p>Last year, I finally decided to get a HTPC hooked up to my TV set (running Windows 8.1). While it has been a major improvement on my TV experience, it has caused some extra woes as well.</p> <p>Due to the machine&#39;s nature, I refuse to hook up a keyboard and mouse. Even a wireless one! The only thing I&#39;ve hooked up, is an IR receiver and I want to keep it this way. Now and then, the machine requires a little bit of maintenance. I like RDP&#39;ing into the machine and manage it remotely. I prefer RDP since it is built in. I don&#39;t want to install yet another VNC service on a machine I want to keep as clean and lightweight as possible. </p> <p><em>I do realize that installing a Linux distro would make it even more lightweight, but I&#39;m currently running a few Windows-only services on it. (I am a .NET developer, after all!)</em></p> <p>RDP, all in all, works great. It does what it&#39;s supposed to do and I hardly have to configure anything to make it work. There is only one downside and sadly, it&#39;s a rather big one. When RDP&#39;ing into the machine, it auto locks. This is something I can live with, as that also means no one is watching my actions through my TV while I&#39;m working on the machine. However, after closing the connection, the machine remains locked. This is a major pain in the ass as it means I&#39;ll have to either reboot the machine (auto-login) or type in my password.... Only there is no keyboard attached.</p> <p>After reading up a bit and tinkering a lot, I&#39;ve come up with a rather decent solution.</p> <h1>Disconnecting through a Task</h1> <p>First, we&#39;ll start by creating a new task. We&#39;ll be creating the task to simplify running an elevated command. Open the <code>Task Scheduler</code> by pressing the <code>Win+R</code> buttons and executing the following command.</p> <div class="highlight"><pre><code class="language-text" data-lang="text">Taskschd.msc
</code></pre></div> <p>After the window opens, right-click the <code>Task Scheduler Library</code>, create a new task and name it <code>Disconnect</code>.</p> <p><img src="http://cdn.thuriot.be/HTPC-RDP/1.New.jpg" alt="Create New Task - General Tab"></p> <p>Don&#39;t forget to tick <code>Run with highest privileges</code>. This will allow the task to run with administrative rights without triggering <a href="https://en.wikipedia.org/wiki/User_Account_Control">UAC</a>. I like having UAC on, but it gets annoying fast for tasks like these. Without administrative rights, it will not work. </p> <p>After doing so, go to the actions tab.</p> <p><img src="http://cdn.thuriot.be/HTPC-RDP/2.Actions.jpg" alt="Actions Tab"></p> <p>Click <code>New</code> and create a new action. The following window opens.</p> <p><img src="http://cdn.thuriot.be/HTPC-RDP/3.Action.jpg" alt="Add Action"></p> <p>The command we will be executing is the following:</p> <div class="highlight"><pre><code class="language-text" data-lang="text">powershell -Command &quot;tscon (qwinsta | ForEach-Object { $_.Trim() -replace &#39;\s+&#39;,&#39;,&#39; } | ConvertFrom-Csv | Where-Object { $_.SESSIONNAME -match &#39;^&gt;&#39; } | Select-Object -First 1 -expand ID) /dest:console&quot;
</code></pre></div> <p>Enter it into the window as shown in the screenshot.</p> <p>Lastly, go to the settings tab. Make sure <code>Allow task to be run on demand</code> is ticked.</p> <p><img src="http://cdn.thuriot.be/HTPC-RDP/4.Settings.jpg" alt="Settings Tab"></p> <h1>A word of explanation: What exactly is happening?</h1> <p>We&#39;re basically running the <code>qwinsta</code> command. This will give us a list of all sessions running on the machine. The current sessions that we are in, will be marked with a <code>&gt;</code>, so we&#39;re filtering that line out. After selecting that line, we want to retrieve the <code>ID</code> column. This is the ID of the current session.</p> <p>After getting the ID, we run the <code>tscon</code> command and pass the id and tell it to connect to <code>console</code>. This will make it drop the RDP connection and connect to its physical console. </p> <p>We have now disconnected the RDP connection and left the machine running unlocked. No keyboard required to watch some TV!</p> <h1>Rounding up</h1> <h2>Starting the task</h2> <p>This task can easily be run with the following command: <em>Note that <code>Disconnect</code> is the name of the task we just created.</em></p> <div class="highlight"><pre><code class="language-text" data-lang="text">schtasks /run /tn &quot;Disconnect&quot;
</code></pre></div> <h2>Simplify, beautify</h2> <p>We can use <a href="http://forum.xda-developers.com/showthread.php?t=1899865">OblyTile</a> to create a Windows 8 tile that will run this command. Then all we have to do is click the tile and we&#39;re disconnect, ready to watch some TV without further interaction.</p> <p>That&#39;s it, enjoy your HTPC!</p> </section> <footer class="post-footer with-cover" style="background-image: url(//cdn.thuriot.be/Covers/db0b47_5415753.jpg)"> <figure class="author-image"> <a class="img" href="//steven.thuriot.be/author/steven" style="background-image: url(//cdn.thuriot.be/Avatars/2014-07-06.jpg)"> <span class="hidden">Steven Thuriot's Picture</span></a> </figure> <section class="author"> <h4><a href="//steven.thuriot.be/author/steven">Steven Thuriot</a></h4> <p>Developer, tinkerer, lifetime student, full time nerd and somewhat of an otaku. Graduated applied computer science followed by a career as a consultant. Likes to complain about traffic.</p> <div class="author-meta"> <span class="author-location fa fa-map-marker">Belgium</span> </div> </section> </footer> </article> <section class="disqus"> <div id="disqus_thread"></div> <script type="text/javascript">(function(){var a=document.createElement("script");a.type="text/javascript";a.async=true;a.src="//thuriot.disqus.com/embed.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a);})();</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a></noscript> </section> </main> <footer class="site-footer clearfix wide"> <section class="copyright"><a href="//steven.thuriot.be">Steven Thuriot.be</a> &copy; 2015</section> </footer> <script type="text/javascript" src="//code.jquery.com/jquery-1.11.3.min.js"></script> <script type="text/javascript" src="//steven.thuriot.be/assets/js/jquery.fitvids.js"></script> </body> </html>
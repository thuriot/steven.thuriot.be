<?xml version="1.0" encoding="UTF-8"?> <rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" version="2.0"> <channel> <title><![CDATA[Steven Thuriot.be &mdash; WPF]]></title> <description><![CDATA[Thoughts, stories and ideas.]]></description> <link>http://steven.thuriot.be</link> <link href="//steven.thuriot.be/tag/wpf/rss/" rel="self" type="application/rss+xml"/> <ttl>60</ttl> <item> <title><![CDATA[WPF: A Model First Approach]]></title> <description><![CDATA[The usual approach, when building a WPF application, even when using a `ViewModel`, fact remains that the views are rather tightly coupled by the model you&#39;re using. Don&#39;t get me wrong though, a well built application will still be easy to adjust when the model changes. But here&#39;s the catch, it won&#39;t be an unusual scenario having to slightly adjust your view when reworking your model. ##Imagine the following scenario You have a property on your model indicating wether you&#39;re in a relationship. This seems pretty straightforward and you&#39;ve always modeled this by using a boolean value on your model. On the view, you&#39;ve placed a checkbox. Simple `yes/no` question, right? However, Facebook and others have already shown us that a lot of people don&#39;t have a `yes/no` answer to this question. If we want to follow in Facebook&#39;s steps, we will have to use a `ComboBox` instead with values like `Yes`, `No` and `It&#39;s Complicated`. After having adjusted our model, the boolean has disappeared and probably been replaced with an `enum` or even a `string` value. The CheckBox no longer suffices, so after this change we&#39;ll have to adjust our view as well by changing the type from CheckBox to ComboBox. This is a hassle and can quickly pull you out of the zone while programming and refactoring. #Approaching from a different angle ##What if... ...instead of adjusting the view to your model, the view is automatically build depending on the model attached to it? That would mean that in our previous sample, a bit of mark up would have to be changed and the view would automatically adjust. This would also mean that a view can be used again with a different model and adjust to it enough to make it seem like it was built just for that model. Taking it a step further, this metadata could even be retrieved from a database at program startup. That would make it possible to change your view completely by adjusting a few fields in your online database, e.g. changing from a simple TextBox to a ComboBox with preset values. Having loved the idea behind this for ages now, I&#39;ve worked on a little WPF framework that does just the thing! Here&#39;s a small preview of a view completely built up from the model. ![Nova Bindings](https://cloud.githubusercontent.com/assets/544444/5234817/8cb922ac-77dd-11e4-801d-bcf6bad9e994.png) ##So how do we use it? ###Including and referencing First step, get a dll from my GitHub repo: [Nova.Bindings](https://github.com/StevenThuriot/Nova.Bindings). Second, merge Nova.Bindings&#39; `ResourceDictionary` into your app&#39;s dictionary. ```xml &lt;ResourceDictionary.MergedDictionaries&gt; &lt;ResourceDictionary Source=&quot;pack://application:,,,/Nova.Bindings;component/ValueEditor.xaml&quot; /&gt; &lt;/ResourceDictionary.MergedDictionaries&gt; ``` ###Views After doing this, views become as simple as using TextBlock/Labels and ValueEditors, combined with a special Binding. It will be the only editor you&#39;ll ever use again! A change in the model? No problem! The Bindings will take care of it for you! ```xml &lt;TextBlock Grid.Column=&quot;0&quot; Text=&quot;{LabelFor Model.Property}&quot; /&gt; &lt;ValueEditor Grid.Column=&quot;1&quot; Value=&quot;{ValueBinding Model.Property}&quot; /&gt; ``` The `LabelFor` binding has a property `AppendColon`, default `true`, which will append a colon to the label. The `ValueBinding` binding has two properties that can be set: * Mode ( == BindingMode, default value is BindingMode.Default ) * Converter ( Default null ) ####Implementation Implement IHaveSettingsManager on your ViewModel. The bindings will try to resolve this Manager (from the control up) to try and find the control&#39;s settings. ####ViewModel ```csharp public class ViewModel : IHaveSettingsManager { public ISettingsManager SettingsManager { get; private set; } public ViewModel() { SettingsManager=new NovaSettingsManager(); } } ``` ####Settings Manager Next, create a settings manager. ```csharp public class NovaSettingsManager : ISettingsManager { private readonly Dictionary&lt;string, IDefinition&gt; _definitions; private readonly DefinitionFactory _factory; public NovaSettingsManager() { _definitions=new Dictionary&lt;string, IDefinition&gt;(); //TODO; _factory=new ComboBoxFactory(); //Good starter since it&#39;s a special case. _factory.SetSuccessor&lt;RadioButtonFactory&gt;() .SetSuccessor&lt;CheckBoxFactory&gt;() .SetSuccessor&lt;DatePickerFactory&gt;() //.......... .SetSuccessor&lt;TextBoxFactory&gt;(); //Decent Fallback in case nothing matches. } public IDefinition GetDefinition(string id) { IDefinition definition; if (_definitions.TryGetValue(id, out definition)) { return definition; } definition=_factory.Create(id); _definitions.Add(id, definition); return definition; } } //Sample [Chain Of Responsilibity](https://www.dofactory.com/net/chain-of-responsibility-design-pattern) abstract class DefinitionFactory { protected DefinitionFactory _successor; public DefinitionFactory SetSuccessor(DefinitionFactory successor) { return _successor=successor; } public DefinitionFactory SetSuccessor&lt;T&gt;() where T : DefinitionFactory, new() { return _successor=new T(); } public IDefinition Create(string id) { var definition=CreateDefinition(id); if (definition != null) return definition; if (_successor != null) { definition=_successor.Create(id); if (definition != null) return definition; } throw new NotSupportedException(id); } protected abstract IDefinition CreateDefinition(string id); } ``` ####Meta Data The id the `GetDefinition` method receives is determined by the metadata you have to place on the model. (Hence **model first**) This is done by adding attributes. ```csharp [Settings(&quot;PersonName&quot;)] public string Name { get; set;} ``` In this specific case, the id will be *PersonName*. Sometimes, fields can have multiple definitions, depending on the situations. Imagine a class where a second property determins if the decorated property is shown as a combobox or a normal text field. This can&#39;t be decorated by a simple attribute. In this case, we can use a second provided attribute. ```csharp [DynamicSettings(&quot;SomeDynamicProperty&quot;)] public string Property { get; set;} ``` When using `Dynamic Settings`, the class that has said property _must_ implement `IHaveDynamicPropertySettings`. ```csharp public class Model : IHaveDynamicPropertySettings { public string ProvideDynamicSettings(string field) { if (field == &quot;SomeDynamicProperty&quot;) { if (SecondProperty == &quot;Something&quot;) { return &quot;PersonName&quot;; } else { return &quot;PersonList&quot;; } } return field; } } ``` The string returned will be the id used in the settings manager to find the correct `IDefinition`. ####Definitions #####Default A definition has the following properties: ```csharp public interface IDefinition { string Id { get; } string Label { get; } string Editor { get; } } ``` * `Id` is the id from the `GetDefinition` method. * `Label` is the text used for the `LabelFor` extension. * `Editor` is the type of editor that needs to be used. This will do for most settings. Two control types require a specific interface to be implemented; #####ComboBox ```csharp public interface IComboBoxDefinition : IDefinition { IEnumerable ItemsSource { get; } } ``` #####RadioButton ```csharp public interface IRadioButtonDefinition : IDefinition { string GroupName { get; } } ``` To make life easier, constants are available! The `Editor` is defined as a string rather than an enum to make it easier to add your own implementations! ```xml Nova.Bindings.ValueEditor.Definitions.ValueTextEditor Nova.Bindings.ValueEditor.Definitions.ValueCheckBoxEditor Nova.Bindings.ValueEditor.Definitions.ValueRadioButtonEditor Nova.Bindings.ValueEditor.Definitions.ValueComboBoxEditor ``` ####Templates A template can easily be added by adding a similar template into the App&#39;s Resource Dictionary. Samples can be found [here](https://github.com/StevenThuriot/Nova.Bindings/blob/master/Nova.Bindings/ValueEditor.xaml). Note that the Template keys are the same as the Editor constants that IDefinition supplies! ```xml &lt;ControlTemplate x:Key=&quot;ValueTextEditor&quot; TargetType=&quot;n:ValueEditor&quot;&gt; &lt;TextBox x:Name=&quot;PART_ValueEditor&quot; Text=&quot;{Binding Value, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}&quot; /&gt; &lt;/ControlTemplate&gt; ``` ]]></description> <link>//steven.thuriot.be/wpf-a-model-first-approach</link> <guid isPermaLink="true">//steven.thuriot.be/wpf-a-model-first-approach</guid> <pubDate>2014-12-03T19:05:00+00:00</pubDate> <media:content url="//cdn.thuriot.be/images/Covers/wpf.jpg" medium="image"/> <content:encoded><![CDATA[<p>The usual approach, when building a WPF application, even when using a <code>ViewModel</code>, fact remains that the views are rather tightly coupled by the model you&#39;re using. </p> <p>Don&#39;t get me wrong though, a well built application will still be easy to adjust when the model changes. But here&#39;s the catch, it won&#39;t be an unusual scenario having to slightly adjust your view when reworking your model.</p> <h2>Imagine the following scenario</h2> <p>You have a property on your model indicating wether you&#39;re in a relationship. This seems pretty straightforward and you&#39;ve always modeled this by using a boolean value on your model. On the view, you&#39;ve placed a checkbox. Simple <code>yes/no</code> question, right?</p> <p>However, Facebook and others have already shown us that a lot of people don&#39;t have a <code>yes/no</code> answer to this question. If we want to follow in Facebook&#39;s steps, we will have to use a <code>ComboBox</code> instead with values like <code>Yes</code>, <code>No</code> and <code>It&#39;s Complicated</code>.</p> <p>After having adjusted our model, the boolean has disappeared and probably been replaced with an <code>enum</code> or even a <code>string</code> value. The CheckBox no longer suffices, so after this change we&#39;ll have to adjust our view as well by changing the type from CheckBox to ComboBox.</p> <p>This is a hassle and can quickly pull you out of the zone while programming and refactoring.</p> <h1>Approaching from a different angle</h1> <h2>What if...</h2> <p>...instead of adjusting the view to your model, the view is automatically build depending on the model attached to it?</p> <p>That would mean that in our previous sample, a bit of mark up would have to be changed and the view would automatically adjust. This would also mean that a view can be used again with a different model and adjust to it enough to make it seem like it was built just for that model.</p> <p>Taking it a step further, this metadata could even be retrieved from a database at program startup. That would make it possible to change your view completely by adjusting a few fields in your online database, e.g. changing from a simple TextBox to a ComboBox with preset values.</p> <p>Having loved the idea behind this for ages now, I&#39;ve worked on a little WPF framework that does just the thing!</p> <p>Here&#39;s a small preview of a view completely built up from the model. <img src="https://cloud.githubusercontent.com/assets/544444/5234817/8cb922ac-77dd-11e4-801d-bcf6bad9e994.png" alt="Nova Bindings"></p> <h2>So how do we use it?</h2> <h3>Including and referencing</h3> <p>First step, get a dll from my GitHub repo: <a href="https://github.com/StevenThuriot/Nova.Bindings">Nova.Bindings</a>.</p> <p>Second, merge Nova.Bindings&#39; <code>ResourceDictionary</code> into your app&#39;s dictionary.</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ResourceDictionary.MergedDictionaries&gt;</span>
        <span class="nt">&lt;ResourceDictionary</span> <span class="na">Source=</span><span class="s">&quot;pack://application:,,,/Nova.Bindings;component/ValueEditor.xaml&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ResourceDictionary.MergedDictionaries&gt;</span>
</code></pre></div> <h3>Views</h3> <p>After doing this, views become as simple as using TextBlock/Labels and ValueEditors, combined with a special Binding. It will be the only editor you&#39;ll ever use again!</p> <p>A change in the model? No problem! The Bindings will take care of it for you!</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;TextBlock</span>   <span class="na">Grid.Column=</span><span class="s">&quot;0&quot;</span> <span class="na">Text=</span><span class="s">&quot;{LabelFor Model.Property}&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;ValueEditor</span> <span class="na">Grid.Column=</span><span class="s">&quot;1&quot;</span> <span class="na">Value=</span><span class="s">&quot;{ValueBinding Model.Property}&quot;</span> <span class="nt">/&gt;</span>
</code></pre></div> <p>The <code>LabelFor</code> binding has a property <code>AppendColon</code>, default <code>true</code>, which will append a colon to the label.</p> <p>The <code>ValueBinding</code> binding has two properties that can be set:</p> <ul> <li>Mode ( == BindingMode, default value is BindingMode.Default )</li> <li>Converter ( Default null )</li> </ul> <h4>Implementation</h4> <p>Implement IHaveSettingsManager on your ViewModel. The bindings will try to resolve this Manager (from the control up) to try and find the control&#39;s settings.</p> <h4>ViewModel</h4> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">ViewModel</span> <span class="p">:</span> <span class="n">IHaveSettingsManager</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">ISettingsManager</span> <span class="n">SettingsManager</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ViewModel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SettingsManager</span> <span class="p">=</span> <span class="k">new</span> <span class="n">NovaSettingsManager</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <h4>Settings Manager</h4> <p>Next, create a settings manager.</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">NovaSettingsManager</span> <span class="p">:</span> <span class="n">ISettingsManager</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">IDefinition</span><span class="p">&gt;</span> <span class="n">_definitions</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="n">DefinitionFactory</span> <span class="n">_factory</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">NovaSettingsManager</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">_definitions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">IDefinition</span><span class="p">&gt;();</span>

        <span class="c1">//TODO;</span>
        <span class="n">_factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ComboBoxFactory</span><span class="p">();</span> <span class="c1">//Good starter since it&#39;s a special case.</span>
        <span class="n">_factory</span><span class="p">.</span><span class="n">SetSuccessor</span><span class="p">&lt;</span><span class="n">RadioButtonFactory</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">SetSuccessor</span><span class="p">&lt;</span><span class="n">CheckBoxFactory</span><span class="p">&gt;()</span>
                <span class="p">.</span><span class="n">SetSuccessor</span><span class="p">&lt;</span><span class="n">DatePickerFactory</span><span class="p">&gt;()</span>
                <span class="c1">//.......... </span>
                <span class="p">.</span><span class="n">SetSuccessor</span><span class="p">&lt;</span><span class="n">TextBoxFactory</span><span class="p">&gt;();</span> <span class="c1">//Decent Fallback in case nothing matches.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IDefinition</span> <span class="nf">GetDefinition</span><span class="p">(</span><span class="kt">string</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">IDefinition</span> <span class="n">definition</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_definitions</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">out</span> <span class="n">definition</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">definition</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">definition</span> <span class="p">=</span> <span class="n">_factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="n">_definitions</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">definition</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">definition</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">//Sample [Chain Of Responsilibity](https://www.dofactory.com/net/chain-of-responsibility-design-pattern)</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">DefinitionFactory</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="n">DefinitionFactory</span> <span class="n">_successor</span><span class="p">;</span>

    <span class="k">public</span> <span class="n">DefinitionFactory</span> <span class="nf">SetSuccessor</span><span class="p">(</span><span class="n">DefinitionFactory</span> <span class="n">successor</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_successor</span> <span class="p">=</span> <span class="n">successor</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">DefinitionFactory</span> <span class="n">SetSuccessor</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;()</span>
        <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">DefinitionFactory</span><span class="p">,</span> <span class="k">new</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_successor</span> <span class="p">=</span> <span class="k">new</span> <span class="n">T</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IDefinition</span> <span class="nf">Create</span><span class="p">(</span><span class="kt">string</span> <span class="n">id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">definition</span> <span class="p">=</span> <span class="n">CreateDefinition</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">definition</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">definition</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">_successor</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">definition</span> <span class="p">=</span> <span class="n">_successor</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">definition</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">definition</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">throw</span> <span class="k">new</span> <span class="nf">NotSupportedException</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">abstract</span> <span class="n">IDefinition</span> <span class="nf">CreateDefinition</span><span class="p">(</span><span class="kt">string</span> <span class="n">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div> <h4>Meta Data</h4> <p>The id the <code>GetDefinition</code> method receives is determined by the metadata you have to place on the model. (Hence <strong>model first</strong>) This is done by adding attributes.</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="na">[Settings(&quot;PersonName&quot;)]</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;}</span>
</code></pre></div> <p>In this specific case, the id will be <em>PersonName</em>. Sometimes, fields can have multiple definitions, depending on the situations. Imagine a class where a second property determins if the decorated property is shown as a combobox or a normal text field. This can&#39;t be decorated by a simple attribute.</p> <p>In this case, we can use a second provided attribute.</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="na">[DynamicSettings(&quot;SomeDynamicProperty&quot;)]</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">Property</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;}</span>
</code></pre></div> <p>When using <code>Dynamic Settings</code>, the class that has said property <em>must</em> implement <code>IHaveDynamicPropertySettings</code>.</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Model</span> <span class="p">:</span> <span class="n">IHaveDynamicPropertySettings</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="nf">ProvideDynamicSettings</span><span class="p">(</span><span class="kt">string</span> <span class="n">field</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">field</span> <span class="p">==</span> <span class="s">&quot;SomeDynamicProperty&quot;</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">SecondProperty</span> <span class="p">==</span> <span class="s">&quot;Something&quot;</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="s">&quot;PersonName&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">return</span> <span class="s">&quot;PersonList&quot;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">field</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>The string returned will be the id used in the settings manager to find the correct <code>IDefinition</code>.</p> <h4>Definitions</h4> <h5>Default</h5> <p>A definition has the following properties:</p> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IDefinition</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">Label</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">Editor</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <ul> <li><code>Id</code> is the id from the <code>GetDefinition</code> method.</li> <li><code>Label</code> is the text used for the <code>LabelFor</code> extension.</li> <li><code>Editor</code> is the type of editor that needs to be used.</li> </ul> <p>This will do for most settings. Two control types require a specific interface to be implemented;</p> <h5>ComboBox</h5> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IComboBoxDefinition</span> <span class="p">:</span> <span class="n">IDefinition</span>
<span class="p">{</span>
    <span class="n">IEnumerable</span> <span class="n">ItemsSource</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <h5>RadioButton</h5> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">IRadioButtonDefinition</span> <span class="p">:</span> <span class="n">IDefinition</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">GroupName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> <p>To make life easier, constants are available! The <code>Editor</code> is defined as a string rather than an enum to make it easier to add your own implementations!</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml">Nova.Bindings.ValueEditor.Definitions.ValueTextEditor
Nova.Bindings.ValueEditor.Definitions.ValueCheckBoxEditor
Nova.Bindings.ValueEditor.Definitions.ValueRadioButtonEditor
Nova.Bindings.ValueEditor.Definitions.ValueComboBoxEditor
</code></pre></div> <h4>Templates</h4> <p>A template can easily be added by adding a similar template into the App&#39;s Resource Dictionary. Samples can be found <a href="https://github.com/StevenThuriot/Nova.Bindings/blob/master/Nova.Bindings/ValueEditor.xaml">here</a>.</p> <p>Note that the Template keys are the same as the Editor constants that IDefinition supplies!</p> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ControlTemplate</span> <span class="na">x:Key=</span><span class="s">&quot;ValueTextEditor&quot;</span> <span class="na">TargetType=</span><span class="s">&quot;n:ValueEditor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;TextBox</span> <span class="na">x:Name=</span><span class="s">&quot;PART_ValueEditor&quot;</span>
             <span class="na">Text=</span><span class="s">&quot;{Binding Value, RelativeSource={RelativeSource TemplatedParent}, Mode=TwoWay}&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/ControlTemplate&gt;</span>
</code></pre></div>]]></content:encoded> </item> <item> <title><![CDATA[WF in WPF: Handing over control to the user]]></title> <description><![CDATA[...because delivering an application set in stone doesn&#39;t always cut it. [![Set in Stone](//cdn.thuriot.be/images/WFinWPF/Stone.jpg)](//cdn.thuriot.be/images/WFinWPF/Stone.jpg) #What is which and which is what?? Before we begin, it is important that we understand all of the concepts used. So we will go over them first. ##WF: Windows Workflow Foundation Workflow foundation is a Microsoft technology that provides the developer with an easy way to host an in-process workflow engine. A workflow is a series of distinct programming steps or phases. A step in workflow is also referred to as an “Activity”. The .NET framework already provides a huge list of these activities, e.g. “Writeline”. While most things can already be achieved using these predefined activities, it is also possible for the developer to create their very own activities. These activities can be used as building blocks to visually assemble a workflow. [![.NET Framework Chart](//cdn.thuriot.be/images/WFinWPF/Chart.jpg)](//cdn.thuriot.be/images/WFinWPF/Chart.jpg) ##WPF: Windows Presentation Foundation The Presentation Foundation is a graphical subsystem for rendering user interfaces in Windows-based applications. WPF runs on top of DirectX. WPF views are built using XAML. This is an XML-based language to define and link various UI elements. #Handing over control? ##Why? A lot of the applications we build on a daily basis have a pretty solid foundation. The general guidelines are written down. These are then turned into code and a single purpose application is built. But what happens when the requirements can change on a daily basis? Or when they can differ greatly on the context they’re used in? This can be solved by handing over the control to the end user. By handing over simple building blocks, rather than lines of code written in stone, we can enable the user to customize the application to their needs at that particular time in an easy and playful manner. [![Lego Building Blocks](//cdn.thuriot.be/images/WFinWPF/Lego.jpg)](//cdn.thuriot.be/images/WFinWPF/Lego.jpg) By teaching the end user how to play with these blocks (or rather, Workflow Activities), (s)he can constantly keep shaping the application to their needs. ##How? Wait a minute... All of this sounds rather hard! The end user won’t be happy with a giant software bill after developing all of this... While it could be a lot of work, it is very easy to achieve this goal by combining WF with WPF! The .NET framework comes with a Workflow designer specifically for WPF. With only a few lines of code, we can offer the end user a visual designer that is easy to use. By dragging and dropping activity blocks, a workflow that suits the user’s needs can be set up in a matter of minutes. Not only is it easy to set up, it’s also very easy to execute, save and load workflows into the application! This way, the end user can set up several workflows they often require and load them up when needed. ###Snippet This sample shows how to do it in only a few lines of *(granted, quick and dirty)* code: ####Window.xaml ```xml &lt;window x:Class=&quot;MainWindow&quot; xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot; xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot; Title=&quot;MainWindow&quot; Height=&quot;350&quot; Width=&quot;525&quot;&gt; &lt;grid x:Name=&quot;_Grid&quot;&gt; &lt;/grid&gt;&lt;grid .ColumnDefinitions&gt; &lt;columndefinition Width=&quot;Auto&quot;&gt;&lt;/columndefinition&gt; &lt;columndefinition Width=&quot;*&quot;&gt;&lt;/columndefinition&gt; &lt;columndefinition Width=&quot;Auto&quot;&gt;&lt;/columndefinition&gt; &lt;/grid&gt; &lt;contentpresenter Grid.Column=&quot;1&quot; Content=&quot;{Binding View}&quot;&gt;&lt;/contentpresenter&gt; &lt;/window&gt; ``` ####Window.xaml.cs ```csharp private void CreateDesigner() { var dm=new DesignerMetadata(); dm.Register(); _designer=new WorkflowDesigner(); _designer.Load(new Sequence()); var designerView=_designer.Context.Services.GetService&amp;lt;DesignerView&amp;gt;(); designerView.WorkflowShellBarItemVisibility = ShellBarItemVisibility.Imports | ShellBarItemVisibility.MiniMap | ShellBarItemVisibility.Variables | ShellBarItemVisibility.Arguments | ShellBarItemVisibility.Zoom; ToolboxControl tc=GetToolboxControl(); Grid.SetColumn(tc, 0); _Grid.Children.Add(tc); var propertyInspectorView=_designer.PropertyInspectorView; Grid.SetColumn(propertyInspectorView, 2); _Grid.Children.Add(propertyInspectorView); DataContext=_designer; } private static ToolboxControl GetToolboxControl() { // Create the ToolBoxControl. var ctrl=new ToolboxControl(); // Create a category. var category=new ToolboxCategory(&quot;category1&quot;); // Create Toolbox items. var tool1=new ToolboxItemWrapper(typeof(Assign)); var tool2=new ToolboxItemWrapper(typeof(Sequence)); var tool3=new ToolboxItemWrapper(typeof(WriteLine)); // Add the Toolbox items to the category. category.Add(tool1); category.Add(tool2); category.Add(tool3); // Add the category to the ToolBox control. ctrl.Categories.Add(category); return ctrl; } ``` ###Executing a workflow: ```csharp _designer.Flush(); string workflow=_designer.Text; var encoding=new ASCIIEncoding(); var bytes=encoding.GetBytes(workflow); using (var stream=new MemoryStream(bytes)) { var activity=ActivityXamlServices.Load(stream); var invoker=new WorkflowInvoker(activity); invoker.Invoke(); } ``` ###Result: [![WPF View Result](//cdn.thuriot.be/images/WFinWPF/Result.png)](//cdn.thuriot.be/images/WFinWPF/Result.png) ]]></description> <link>//steven.thuriot.be/wf-in-wpf-handing-over-control-to-the-user</link> <guid isPermaLink="true">//steven.thuriot.be/wf-in-wpf-handing-over-control-to-the-user</guid> <pubDate>2013-07-01T09:30:00+00:00</pubDate> <content:encoded><![CDATA[<p>...because delivering an application set in stone doesn&#39;t always cut it.</p> <p><a href="//cdn.thuriot.be/images/WFinWPF/Stone.jpg"><img src="//cdn.thuriot.be/images/WFinWPF/Stone.jpg" alt="Set in Stone"></a></p> <h1>What is which and which is what??</h1> <p>Before we begin, it is important that we understand all of the concepts used. So we will go over them first.</p> <h2>WF: Windows Workflow Foundation</h2> <p>Workflow foundation is a Microsoft technology that provides the developer with an easy way to host an in-process workflow engine.</p> <p>A workflow is a series of distinct programming steps or phases. A step in workflow is also referred to as an “Activity”. The .NET framework already provides a huge list of these activities, e.g. “Writeline”. While most things can already be achieved using these predefined activities, it is also possible for the developer to create their very own activities.</p> <p>These activities can be used as building blocks to visually assemble a workflow.</p> <p><a href="//cdn.thuriot.be/images/WFinWPF/Chart.jpg"><img src="//cdn.thuriot.be/images/WFinWPF/Chart.jpg" alt=".NET Framework Chart"></a></p> <h2>WPF: Windows Presentation Foundation</h2> <p>The Presentation Foundation is a graphical subsystem for rendering user interfaces in Windows-based applications. WPF runs on top of DirectX.</p> <p>WPF views are built using XAML. This is an XML-based language to define and link various UI elements.</p> <h1>Handing over control?</h1> <h2>Why?</h2> <p>A lot of the applications we build on a daily basis have a pretty solid foundation. The general guidelines are written down. These are then turned into code and a single purpose application is built.</p> <p>But what happens when the requirements can change on a daily basis? Or when they can differ greatly on the context they’re used in?</p> <p>This can be solved by handing over the control to the end user. By handing over simple building blocks, rather than lines of code written in stone, we can enable the user to customize the application to their needs at that particular time in an easy and playful manner.</p> <p><a href="//cdn.thuriot.be/images/WFinWPF/Lego.jpg"><img src="//cdn.thuriot.be/images/WFinWPF/Lego.jpg" alt="Lego Building Blocks"></a></p> <p>By teaching the end user how to play with these blocks (or rather, Workflow Activities), (s)he can constantly keep shaping the application to their needs.</p> <h2>How?</h2> <p>Wait a minute... All of this sounds rather hard! The end user won’t be happy with a giant software bill after developing all of this...</p> <p>While it could be a lot of work, it is very easy to achieve this goal by combining WF with WPF!</p> <p>The .NET framework comes with a Workflow designer specifically for WPF. With only a few lines of code, we can offer the end user a visual designer that is easy to use. By dragging and dropping activity blocks, a workflow that suits the user’s needs can be set up in a matter of minutes.</p> <p>Not only is it easy to set up, it’s also very easy to execute, save and load workflows into the application! This way, the end user can set up several workflows they often require and load them up when needed.</p> <h3>Snippet</h3> <p>This sample shows how to do it in only a few lines of <em>(granted, quick and dirty)</em> code:</p> <h4>Window.xaml</h4> <div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;window</span> <span class="na">x:Class=</span><span class="s">&quot;MainWindow&quot;</span>
        <span class="na">xmlns=</span><span class="s">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span>
        <span class="na">xmlns:x=</span><span class="s">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span>
        <span class="na">Title=</span><span class="s">&quot;MainWindow&quot;</span> <span class="na">Height=</span><span class="s">&quot;350&quot;</span> <span class="na">Width=</span><span class="s">&quot;525&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;grid</span> <span class="na">x:Name=</span><span class="s">&quot;_Grid&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;/grid&gt;&lt;grid</span> <span class="err">.ColumnDefinitions</span><span class="nt">&gt;</span>
            <span class="nt">&lt;columndefinition</span> <span class="na">Width=</span><span class="s">&quot;Auto&quot;</span><span class="nt">&gt;&lt;/columndefinition&gt;</span>
            <span class="nt">&lt;columndefinition</span> <span class="na">Width=</span><span class="s">&quot;*&quot;</span><span class="nt">&gt;&lt;/columndefinition&gt;</span>
            <span class="nt">&lt;columndefinition</span> <span class="na">Width=</span><span class="s">&quot;Auto&quot;</span><span class="nt">&gt;&lt;/columndefinition&gt;</span>
        <span class="nt">&lt;/grid&gt;</span>

        <span class="nt">&lt;contentpresenter</span> <span class="na">Grid.Column=</span><span class="s">&quot;1&quot;</span> <span class="na">Content=</span><span class="s">&quot;{Binding View}&quot;</span><span class="nt">&gt;&lt;/contentpresenter&gt;</span>

<span class="nt">&lt;/window&gt;</span>
</code></pre></div> <h4>Window.xaml.cs</h4> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">CreateDesigner</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">dm</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DesignerMetadata</span><span class="p">();</span>
    <span class="n">dm</span><span class="p">.</span><span class="n">Register</span><span class="p">();</span>

    <span class="n">_designer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WorkflowDesigner</span><span class="p">();</span>
    <span class="n">_designer</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="k">new</span> <span class="n">Sequence</span><span class="p">());</span>

    <span class="kt">var</span> <span class="n">designerView</span> <span class="p">=</span> <span class="n">_designer</span><span class="p">.</span><span class="n">Context</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">GetService</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">DesignerView</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;();</span>

    <span class="n">designerView</span><span class="p">.</span><span class="n">WorkflowShellBarItemVisibility</span> <span class="p">=</span>
        <span class="n">ShellBarItemVisibility</span><span class="p">.</span><span class="n">Imports</span> <span class="p">|</span>
        <span class="n">ShellBarItemVisibility</span><span class="p">.</span><span class="n">MiniMap</span> <span class="p">|</span>
        <span class="n">ShellBarItemVisibility</span><span class="p">.</span><span class="n">Variables</span> <span class="p">|</span>
        <span class="n">ShellBarItemVisibility</span><span class="p">.</span><span class="n">Arguments</span> <span class="p">|</span>
        <span class="n">ShellBarItemVisibility</span><span class="p">.</span><span class="n">Zoom</span><span class="p">;</span>

    <span class="n">ToolboxControl</span> <span class="n">tc</span> <span class="p">=</span> <span class="n">GetToolboxControl</span><span class="p">();</span>
    <span class="n">Grid</span><span class="p">.</span><span class="n">SetColumn</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>

    <span class="n">_Grid</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tc</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">propertyInspectorView</span> <span class="p">=</span> <span class="n">_designer</span><span class="p">.</span><span class="n">PropertyInspectorView</span><span class="p">;</span>

    <span class="n">Grid</span><span class="p">.</span><span class="n">SetColumn</span><span class="p">(</span><span class="n">propertyInspectorView</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>
    <span class="n">_Grid</span><span class="p">.</span><span class="n">Children</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">propertyInspectorView</span><span class="p">);</span>

    <span class="n">DataContext</span> <span class="p">=</span> <span class="n">_designer</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">static</span> <span class="n">ToolboxControl</span> <span class="nf">GetToolboxControl</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Create the ToolBoxControl.</span>
    <span class="kt">var</span> <span class="n">ctrl</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ToolboxControl</span><span class="p">();</span>

    <span class="c1">// Create a category.</span>
    <span class="kt">var</span> <span class="n">category</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ToolboxCategory</span><span class="p">(</span><span class="s">&quot;category1&quot;</span><span class="p">);</span>

    <span class="c1">// Create Toolbox items.</span>
    <span class="kt">var</span> <span class="n">tool1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ToolboxItemWrapper</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Assign</span><span class="p">));</span>
    <span class="kt">var</span> <span class="n">tool2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ToolboxItemWrapper</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Sequence</span><span class="p">));</span>
    <span class="kt">var</span> <span class="n">tool3</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ToolboxItemWrapper</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">WriteLine</span><span class="p">));</span>

    <span class="c1">// Add the Toolbox items to the category.</span>
    <span class="n">category</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tool1</span><span class="p">);</span>
    <span class="n">category</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tool2</span><span class="p">);</span>
    <span class="n">category</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tool3</span><span class="p">);</span>

    <span class="c1">// Add the category to the ToolBox control.</span>
    <span class="n">ctrl</span><span class="p">.</span><span class="n">Categories</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">category</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ctrl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <h3>Executing a workflow:</h3> <div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="n">_designer</span><span class="p">.</span><span class="n">Flush</span><span class="p">();</span>
<span class="kt">string</span> <span class="n">workflow</span> <span class="p">=</span> <span class="n">_designer</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">encoding</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ASCIIEncoding</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">bytes</span> <span class="p">=</span> <span class="n">encoding</span><span class="p">.</span><span class="n">GetBytes</span><span class="p">(</span><span class="n">workflow</span><span class="p">);</span>

<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">stream</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MemoryStream</span><span class="p">(</span><span class="n">bytes</span><span class="p">))</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">activity</span> <span class="p">=</span> <span class="n">ActivityXamlServices</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">stream</span><span class="p">);</span>

    <span class="kt">var</span> <span class="n">invoker</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WorkflowInvoker</span><span class="p">(</span><span class="n">activity</span><span class="p">);</span>
    <span class="n">invoker</span><span class="p">.</span><span class="n">Invoke</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div> <h3>Result:</h3> <p><a href="//cdn.thuriot.be/images/WFinWPF/Result.png"><img src="//cdn.thuriot.be/images/WFinWPF/Result.png" alt="WPF View Result"></a></p> ]]></content:encoded> </item> </channel> </rss>